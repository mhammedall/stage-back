pipeline {
  agent any

  stages {
    stage('Checkout') { steps { checkout scm } }

    stage('Setup') { steps { sh 'node -v && npm -v' } }

    stage('Build') { steps { sh 'docker build -t express-dev .' } }

    stage('Run (Docker)') { steps { sh 'docker run -d -p 3001:3000 --name dev-test express-dev' } }

    stage('Smoke Test') { steps { sh 'curl http://localhost:3001/' } }

    stage('Archive Artifacts') { steps { archiveArtifacts artifacts: '**/*.log' } }

    stage('Cleanup') { steps { sh 'docker rm -f dev-test || true' } }
  }
}
